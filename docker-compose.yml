version: '3.8'

services:
  backend:
    image: deeeye2/devops-bot-terminal-backend:v1.0.1
    container_name: devops-terminal-backend
    ports:
      - "3001:3001"
    environment:
      - SSH_HOST=localhost
      - SSH_PORT=22
      - SSH_USERNAME=user
      - SSH_PASSWORD=pass
    networks:
      - web-terminal-network

  frontend:
    build:
      context: ./frontend  # Updated build context to ensure it includes all frontend files
    container_name: devops-terminal-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    environment:
      - REACT_APP_BACKEND_URL=http://backend:3001
      - REACT_APP_WS_URL=ws://backend:3001/ws
    networks:
      - web-terminal-network

  nginx:
    image: nginx:alpine
    container_name: devops-terminal-nginx
    ports:
      - "8081:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf         # Main Nginx configuration
      - ./nginx/server.conf:/etc/nginx/conf.d/server.conf  # Server configuration
      - ./frontend/build:/usr/share/nginx/html           # Map the build directory to Nginx's root directory
    depends_on:
      - frontend
    networks:
      - web-terminal-network

networks:
  web-terminal-network:
    driver: bridge


